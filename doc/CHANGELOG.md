# 変更履歴

このプロジェクトの重要な変更はすべてこのファイルに記録されます。

## [1.0.0] - 2024-12-XX

### 初回リリース（日本語専用版）

このバージョンは、[ClipsAI](https://github.com/ClipsAI/clipsai)の日本語専用フォーク版として初回リリースされました。

### 主な変更点

#### 文字起こしエンジンの変更
- **`whisperx`から`faster-whisper`への移行**
  - `whisperx`の依存関係の問題（PyTorch 2.8.0との互換性問題）を解決
  - `faster-whisper`は`torch`に依存せず、依存関係の競合を大幅に削減
  - 文字起こしのパフォーマンスと安定性を向上

#### 依存関係の最適化
- **`facenet-pytorch`の削除**
  - MediaPipe Face Detectionに置き換え（既に実装済み）
  - `numpy`と`torch`のバージョン制約を緩和
- **オプショナル依存関係の整理**
  - `pynvml`を`extras_require["gpu"]`に移動
  - `pytest`、`pandas`、`matplotlib`を`extras_require["dev"]`に移動
- **依存関係のバージョン制約の改善**
  - `numpy`: `>=1.24.0,<2.1.0`（`faster-whisper`の柔軟な要件に対応）
  - `torch`: `>=2.0.0,<3.0.0`（`pyannote.audio`の要件に合わせて設定）

#### パッケージ名の変更
- **`clipsai` → `clipsai-jp`**
  - PyPIでの公開名を`clipsai-jp`に変更
  - 日本語専用版であることを明確化

### 互換性に関する注意事項
- 元の`clipsai`パッケージとは別のパッケージとして公開されます
- `faster-whisper`を使用するため、`whisperx`のインストールは不要です
- 既存のコードとの互換性は維持されています（APIは変更なし）

### ドキュメント
- `README.md`を日本語専用版向けに更新
- `doc/SAMPLE_CODE.md`にインストール手順とトラブルシューティングを追加
- PyPIバッジを追加

## [未リリース]

### 更新内容
- すべての依存関係を最新の互換バージョンに更新し、バージョン範囲を指定
- `setup.py`に全18の依存関係のバージョン制約を追加
- 開発・テスト環境用の`requirements.txt`を作成
- `use_auth_token`と`token`パラメータの両方をサポートすることで、pyannote.audio 4.0+との互換性を改善

### 更新された依存関係
- **torch**: >=2.0.0,<3.0.0 (最大2.9.1までサポート)
- **sentence-transformers**: >=3.0.0,<6.0.0 (最大5.2.0までサポート)
- **pyannote.audio**: >=3.3.0,<5.0.0 (最大4.0.3までサポート)
- **pyannote.core**: >=5.0.0,<7.0.0 (最大6.0.1までサポート)
- **numpy**: >=1.21.0,<3.0.0 (最大2.4.0までサポート)
- **opencv-python**: >=4.5.0,<5.0.0 (最大4.12.0.88までサポート)
- **pandas**: >=2.0.0,<3.0.0 (最大2.3.3までサポート)
- **scikit-learn**: >=1.3.0,<2.0.0 (最大1.8.0までサポート)
- **mediapipe**: >=0.10.20,<0.11.0 (最大0.10.31までサポート)
- **av**: >=11.0.0,<17.0.0 (最大16.0.1までサポート)
- **scenedetect**: >=0.6.5,<0.7.0 (最大0.6.7.1までサポート)
- **scipy**: >=1.9.0,<2.0.0 (最大1.16.3までサポート)
- **psutil**: >=5.9.0,<8.0.0 (最大7.1.3までサポート)
- **matplotlib**: >=3.8.0,<4.0.0 (最大3.10.8までサポート)
- **nltk**: >=3.8.0,<4.0.0 (最大3.9.2までサポート)
- **pynvml**: >=11.0.0,<14.0.0 (最大13.0.1までサポート)
- **python-magic**: >=0.4.20,<0.5.0 (最大0.4.27までサポート)
- **pytest**: >=7.0.0,<9.0.0 (最大8.3.4までサポート)

### 互換性に関する注意事項
- **pyannote.audio**: ライブラリは`use_auth_token`（バージョン < 4.0）と`token`（バージョン >= 4.0）の両方のパラメータを自動的にサポートします
- **Windows/Mac**: すべての依存関係はWindowsとMacの両方のプラットフォームと互換性があります
- **MPSサポート**: PyTorch MPS（Apple Silicon GPU）サポートはtorch >= 2.0.0で維持されています

### テスト
- 既存のテストはすべて通過（61/65テスト通過）
- 4つのテスト失敗は既存のモック問題に関連しており、依存関係の更新とは無関係です
- インポートテストでコア機能を検証
- 統合テストを作成し、すべて通過（8/8テスト通過）
  - ワークフローコンポーネントのインスタンス化テスト
  - コンポーネント互換性テスト
  - MPS（Apple Silicon）サポートの検証
- プラットフォームテスト:
  - Windows: テスト済み・検証済み
  - Mac: コードレベルでの検証完了（MPSサポートがコードで確認済み）

### 既知の問題と制限事項
- **依存関係の競合**: 一部の依存関係（torch/torchvision、numpy、huggingface-hub/transformers）でバージョン競合が発生する可能性があります
  - torch 2.9.1とtorchvision 0.17.2は互換性がありません（torchvision 0.17.2はtorch 2.2.2を要求）
  - numpy 2.xと一部のパッケージ（facenet-pytorch、mediapipe、numba）は互換性の問題があります
  - huggingface-hubとtransformersのバージョン要件が競合する場合があります
- **推奨される解決策**: 
  - 仮想環境を使用して依存関係を分離する
  - `requirements.txt`を使用して開発環境を再現する
  - 本番環境では`setup.py`のバージョン範囲に基づいてインストールする

### ドキュメント
- ドキュメントを`doc/`ディレクトリに整理
  - `doc/CHANGELOG.md`: 変更履歴
  - `doc/UPDATE_DEPENDENCIES.md`: 依存関係更新ガイド